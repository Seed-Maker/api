const AJAX_RESPONSE_ERROR='response error';let ajax={};ajax.fetch=function(a,b){let f,h,c=new XMLHttpRequest,d='GET',g='';if('string'==typeof a&&(a={path:a}),!a||'object'!=typeof a)return Promise.reject(new TypeError('first argument is not an object or string.'));if(f=a.path,'string'!=typeof f)return Promise.reject(new Error('path not found'));try{d=a.method.toUpperCase()||d}catch(j){d=void 0}finally{if(null==d&&(d='GET'),'GET'!=d&&'POST'!=d)throw new Error('unknown method.')}for(let j in a.param)if(a.param.hasOwnProperty(j)){switch(typeof a.param[j]){case'string':case'number':a.param[j]+='';break;default:a.param[j]=JSON.stringify(a.param[j]);}g+=j+'='+encodeURIComponent(a.param[j])+'&'}switch(g=g.slice(0,g.length-1),g&&'GET'===d&&(f+='?'+g,g=0),g=g||void 0,typeof a.callback){case'function':h=a.callback;break;case'string':h=Function(a.callback);break;default:h=function(){};}return c.open(d,f,!0),'POST'===d&&c.setRequestHeader('Content-type','application/x-www-form-urlencoded'),new Promise(function(j,k){function l(n){h(n),j(n)}function m(n){h(n),k(n)}c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status){let n=c.responseText;switch(b){case JSON:try{n=JSON.parse(n)}catch(o){return void m(o)}break;case HTMLElement:n=function(){let o=document.createElement('div');return o.innerHTML=n,o.childNodes}();default:}l(n)}else m(new Error('Response error. \n HTTP Status: '+c.status))},c.send(g)})},ajax.fetchText=function(a){return ajax.fetch(a)},ajax.fetchJSON=function(a){return ajax.fetch(a,JSON)},ajax.fetchHTML=function(a){return ajax.fetch(a,HTMLElement)},ajax.sendFiles=function(a){if(!window.FormData)return!1;let h,b=new XMLHttpRequest,c=new FormData,d=a.path,f=a.files;if(!a.path)return Promise.reject(new Error('path not found'));for(let j=0;j<f.length;j++)c.append('uploadfile'+j,f[j]);switch(typeof a.callback){case'function':h=a.callback;break;case'string':h=Function(a.callback);break;default:h=function(){};}return b.open('POST',d,!0),new Promise(function(j,k){b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status)h(b.responseText),j(b.responseText);else{let l=new Error('Response error. \n HTTP Status: '+b.status);h(l),k(l)}},b.send(c)})};
